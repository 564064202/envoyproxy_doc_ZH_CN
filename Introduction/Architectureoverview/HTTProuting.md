### HTTP路由

Envoy包含一个HTTP路由过滤器，可以用它来执行高级路由任务。这对于处理前端流量（传统方式用反向代理来处理请求），或者构建服务间的Envoy网格是很有用的（通常根据HTTP头部上字段可以路由以到达指定的上游服务集群）。 Envoy也支持配置为正向代理。在转发代理配置中，网络客户端可以通过将他们的http代理适当地配置为Envoy。在高层次上，路由器接收一个传入的HTTP请求，将其与上游集群进行匹配，获取到上游集群中主机的连接池，并转发该请求。路由器过滤器支持以下功能：

- 将domains/authorities映射到一组路由规则的虚拟主机
- 前缀和精确路径匹配规则（区分大小写和不区分大小写）。当前不支持正则表达式/slug匹配，主要是因为它无法精确辨别路由规则是否相互冲突。由于这个原因，我们不建议在反向代理级别使用正则表达式/slug路由，但是我们可能会根据需求添加支持
- 根据TLS重定向到虚拟主机
- 根据path/host重定向的路由规则
- 显式host改写
- 根据上游主机的DNS名称自动重写host
- Prefix重写
- Websocket在路由级别升级
- 通过HTTP头或通过路由配置请求重试
- 通过HTTP头或通过路由配置指定的请求超时
- 通过运行时间值将流量从一个上游群集转移到另一个上（请参阅流量转移/分流）
- 使用基于权重/百分比的路由（请参阅流量转移/拆分）跨多个上游群集进行流量分流
- 任意头匹配路由规则
- 虚拟集群场景，指定虚拟主机作为虚拟群集，由Envoy用于在标准群集级别之上生成附加统计信息。虚拟群集可以使用正则表达式匹配
- 基于优先级的路由
- 基于哈希策略的路由
- 非转发代理支持绝对url

#### 路由表
HTTP连接管理器的配置，拥有所有配置的HTTP过滤器使用的路由表。虽然路由表主要用于路由过滤器，但是如果他们想根据请求的最终目的地做出决定，其他过滤器也可以访问。例如，内置的速率限制过滤器参考路由表来确定是否应该基于路由来调用全局速率限制服务。即使决策涉及随机性（例如，在运行时配置路由规则的情况下），连接管理器也确保所有获取路由的调用对于特定请求是稳定的。


#### 重试语义
Envoy允许在路由配置中以及通过请求头对特定请求配置重试。存在如下可能的配置：

- **最大重试次数**：Envoy将继续重试任意次数。在每次重试之间使用指数退避算法。此外，所有重试都包含在整个请求超时内。由于大量的重试，这避免了很长的请求时间。
- **条件重试**：Envoy可以根据应用要求在不同类型的条件下重试。例如，网络故障，所有5xx响应码，幂等4xx响应码等。

请注意：根据x-envoy重载的内容，重试可能无法使用。

#### 优先级路由
Envoy支持路由级别的优先级路由。当前的优先级实现针对每个优先级级别使用不同的连接池和断路设置。这意味着即使对于HTTP/2请求，两个物理连接也将被用于上游主机。未来，Envoy可能会在单一连接上支持真正的HTTP/2优先级。

目前支持默认和高两个优先级。

### 返回
- [架构介绍](../Architectureoverview.md)
- [简介](../../Introduction.md)
- [首页目录](../../README.md)